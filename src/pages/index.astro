---
export const prerender = false;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OTLP Payload Validator</title>
    <script is:inline>
      // Prevent flash of unstyled content - set theme before render
      (function() {
        const stored = localStorage.getItem('theme');
        const system = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', stored || system);
      })();
    </script>
    <style is:global>
      /* ===== CSS Custom Properties ===== */
      :root {
        /* Base colors - Light mode */
        --bg-primary: #f0f4f8;
        --bg-secondary: #ffffff;
        --bg-tertiary: #e2e8f0;

        /* Text colors */
        --text-primary: #1a202c;
        --text-secondary: #4a5568;
        --text-muted: #718096;

        /* Accent colors - Futuristic cyan/purple */
        --accent-primary: #00d4ff;
        --accent-secondary: #7c3aed;

        /* Semantic colors */
        --success: #10b981;
        --success-bg: #d1fae5;
        --success-border: #a7f3d0;
        --error: #ef4444;
        --error-bg: #fee2e2;
        --error-border: #fecaca;
        --warning: #f59e0b;
        --warning-bg: #fef3c7;
        --warning-border: #fde68a;

        /* Glow effects */
        --glow-primary: rgba(0, 212, 255, 0.25);
        --glow-secondary: rgba(124, 58, 237, 0.25);

        /* Borders and shadows */
        --border-color: rgba(0, 0, 0, 0.1);
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
        --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.08);
        --shadow-glow: 0 0 20px var(--glow-primary);

        /* Component specific */
        --card-border: 1px solid var(--border-color);
        --input-bg: var(--bg-secondary);
        --input-border: #d1d5db;
        --button-secondary-bg: #e5e7eb;
        --button-secondary-hover: #d1d5db;
      }

      [data-theme="dark"] {
        /* Base colors - Dark mode */
        --bg-primary: #0a0e17;
        --bg-secondary: #131a2b;
        --bg-tertiary: #1e293b;

        /* Text colors */
        --text-primary: #f1f5f9;
        --text-secondary: #94a3b8;
        --text-muted: #64748b;

        /* Accent colors - Brighter for dark mode */
        --accent-primary: #00ffff;
        --accent-secondary: #a855f7;

        /* Semantic colors - More vibrant in dark mode */
        --success: #22c55e;
        --success-bg: rgba(34, 197, 94, 0.15);
        --success-border: rgba(34, 197, 94, 0.3);
        --error: #f87171;
        --error-bg: rgba(248, 113, 113, 0.15);
        --error-border: rgba(248, 113, 113, 0.3);
        --warning: #fbbf24;
        --warning-bg: rgba(251, 191, 36, 0.15);
        --warning-border: rgba(251, 191, 36, 0.3);

        /* Glow effects - More pronounced */
        --glow-primary: rgba(0, 255, 255, 0.3);
        --glow-secondary: rgba(168, 85, 247, 0.3);

        /* Borders and shadows */
        --border-color: rgba(255, 255, 255, 0.1);
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.4);
        --shadow-glow: 0 0 30px var(--glow-primary);

        /* Component specific */
        --card-border: 1px solid var(--border-color);
        --input-bg: var(--bg-tertiary);
        --input-border: #374151;
        --button-secondary-bg: #374151;
        --button-secondary-hover: #4b5563;
      }

      /* ===== Base Reset ===== */
      * {
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        background: var(--bg-primary);
        color: var(--text-primary);
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      /* ===== Typography ===== */
      h1 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        letter-spacing: -0.02em;
      }

      .subtitle {
        color: var(--text-secondary);
        margin-bottom: 1rem;
      }

      /* ===== Header Elements ===== */
      .header-row {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .github-link {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 0.9rem;
        transition: color 0.2s ease;
      }

      .github-link:hover {
        color: var(--text-primary);
        text-decoration: underline;
      }

      .github-link svg {
        width: 18px;
        height: 18px;
      }

      .theme-toggle {
        margin-left: auto;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: var(--bg-secondary);
        border: var(--card-border);
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        color: var(--text-secondary);
      }

      .theme-toggle:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        box-shadow: var(--shadow-sm);
      }

      .theme-toggle svg {
        width: 20px;
        height: 20px;
        fill: currentColor;
        flex-shrink: 0;
      }

      /* Default/Light mode: show moon icon */
      .theme-toggle .sun-icon {
        display: none;
      }

      .theme-toggle .moon-icon {
        display: block;
      }

      /* Dark mode: show sun icon */
      html[data-theme="dark"] .theme-toggle .sun-icon {
        display: block;
      }

      html[data-theme="dark"] .theme-toggle .moon-icon {
        display: none;
      }

      /* ===== Card Sections ===== */
      .input-section {
        background: var(--bg-secondary);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-md);
        border: var(--card-border);
        transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
      }

      .input-section h2 {
        margin-top: 0;
        font-size: 1.1rem;
        color: var(--text-secondary);
      }

      /* ===== Form Elements ===== */
      textarea {
        width: 100%;
        height: 300px;
        font-family: "Monaco", "Menlo", "Consolas", monospace;
        font-size: 13px;
        padding: 1rem;
        border: 1px solid var(--input-border);
        border-radius: 8px;
        resize: vertical;
        tab-size: 2;
        background: var(--input-bg);
        color: var(--text-primary);
        transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease;
      }

      textarea:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px var(--glow-primary);
      }

      .file-upload {
        margin-top: 1rem;
        padding: 1rem;
        border: 2px dashed var(--input-border);
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        background: var(--input-bg);
        transition: border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
      }

      .file-upload:hover {
        border-color: var(--accent-primary);
        background: var(--bg-tertiary);
      }

      .file-upload.dragover {
        border-color: var(--accent-primary);
        background: var(--bg-tertiary);
        box-shadow: 0 0 0 3px var(--glow-primary);
      }

      .file-upload p {
        margin: 0;
        color: var(--text-secondary);
      }

      /* ===== Buttons ===== */
      .buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-top: 1rem;
      }

      button {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      button:active {
        transform: scale(0.98);
      }

      .validate-btn {
        background: var(--accent-primary);
        color: white;
        font-weight: 500;
      }

      .validate-btn:hover {
        filter: brightness(1.1);
      }

      .validate-btn:disabled {
        background: var(--button-secondary-bg);
        color: var(--text-muted);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .clear-btn {
        background: var(--button-secondary-bg);
        color: var(--text-primary);
        border: var(--card-border);
      }

      .clear-btn:hover {
        background: var(--button-secondary-hover);
      }

      .example-btn {
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        font-size: 0.9rem;
        padding: 0.6rem 1rem;
        border: var(--card-border);
      }

      .example-btn:hover {
        background: var(--button-secondary-bg);
        color: var(--text-primary);
      }

      .results-section {
        background: var(--bg-secondary);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: var(--shadow-md);
        border: var(--card-border);
        transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
      }

      .results-section h2 {
        margin-top: 0;
        font-size: 1.1rem;
        color: var(--text-secondary);
      }

      /* ===== Status Indicators ===== */
      .result-status {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      .result-status.valid {
        background: var(--success-bg);
        color: var(--success);
        border: 1px solid var(--success-border);
        box-shadow: 0 0 15px rgba(16, 185, 129, 0.15);
      }

      .result-status.invalid {
        background: var(--error-bg);
        color: var(--error);
        border: 1px solid var(--error-border);
        box-shadow: 0 0 15px rgba(239, 68, 68, 0.15);
      }

      .result-status.pending {
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
      }

      .payload-type {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        background: var(--border-color);
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 500;
        margin-left: 0.5rem;
      }

      /* ===== Error/Warning Lists ===== */
      .error-list,
      .warning-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .error-group {
        margin-bottom: 1rem;
        background: var(--error-bg);
        border: 1px solid var(--error-border);
        border-radius: 10px;
        overflow: hidden;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      .error-group-header {
        background: var(--error);
        color: white;
        padding: 0.75rem 1rem;
        font-family: "Monaco", "Menlo", "Consolas", monospace;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .error-group-header .path-icon {
        opacity: 0.8;
      }

      .error-group-header .path-text {
        word-break: break-all;
      }

      .error-group-body {
        padding: 0;
      }

      .error-item {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--error-border);
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
      }

      .error-item:last-child {
        border-bottom: none;
      }

      .error-icon {
        color: var(--error);
        font-size: 1rem;
        flex-shrink: 0;
        margin-top: 0.1rem;
      }

      .error-content {
        flex: 1;
        min-width: 0;
      }

      .error-message {
        color: var(--text-primary);
        font-size: 0.95rem;
        line-height: 1.4;
        margin-bottom: 0.5rem;
      }

      .error-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
      }

      .error-keyword {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: var(--error);
        color: white;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
      }

      .error-keyword.type {
        background: #8b5cf6;
      }
      .error-keyword.pattern {
        background: #3b82f6;
      }
      .error-keyword.enum {
        background: #f97316;
      }
      .error-keyword.required {
        background: var(--error);
      }
      .error-keyword.semantic {
        background: var(--success);
      }

      .error-count {
        display: inline-block;
        background: var(--error);
        color: white;
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.2rem 0.6rem;
        border-radius: 10px;
        margin-left: auto;
      }

      .warning-group {
        margin-bottom: 1rem;
        background: var(--warning-bg);
        border: 1px solid var(--warning-border);
        border-radius: 10px;
        overflow: hidden;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      .warning-group-header {
        background: var(--warning);
        color: white;
        padding: 0.75rem 1rem;
        font-family: "Monaco", "Menlo", "Consolas", monospace;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .warning-item {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--warning-border);
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
      }

      .warning-item:last-child {
        border-bottom: none;
      }

      .warning-icon {
        color: var(--warning);
        font-size: 1rem;
        flex-shrink: 0;
        margin-top: 0.1rem;
      }

      .warning-content {
        flex: 1;
        min-width: 0;
      }

      .warning-message {
        color: var(--text-primary);
        font-size: 0.95rem;
        line-height: 1.4;
      }

      .warning-suggestion {
        margin-top: 0.5rem;
        color: var(--text-secondary);
        font-size: 0.85rem;
        font-style: italic;
        padding-left: 0.75rem;
        border-left: 2px solid var(--warning-border);
      }

      /* ===== Summary Bar ===== */
      .summary-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
        padding: 0.75rem 1rem;
        background: var(--bg-tertiary);
        border-radius: 8px;
        font-size: 0.9rem;
        align-items: center;
        transition: background-color 0.3s ease;
      }

      .summary-item {
        display: flex;
        align-items: center;
        gap: 0.4rem;
      }

      .summary-item.errors {
        color: var(--error);
      }

      .summary-item.warnings {
        color: var(--warning);
      }

      .copy-llm-btn {
        margin-left: auto;
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.4rem 0.75rem;
        background: var(--accent-secondary);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .copy-llm-btn:hover {
        filter: brightness(1.1);
      }

      .copy-llm-btn:active {
        transform: scale(0.98);
      }

      .copy-llm-btn.copied {
        background: var(--success);
      }

      h3 {
        font-size: 1rem;
        color: var(--text-secondary);
        margin: 1.5rem 0 0.75rem;
      }

      h3:first-of-type {
        margin-top: 0.5rem;
      }

      /* ===== Footer ===== */
      .footer {
        margin-top: 3rem;
        padding: 1.5rem;
        text-align: center;
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      .footer a {
        color: var(--text-secondary);
        text-decoration: none;
        transition: color 0.2s ease;
      }

      .footer a:hover {
        color: var(--accent-primary);
      }

      .jump-text {
        display: inline-flex;
      }

      .jump-text span {
        display: inline-block;
        transition: transform 0.2s ease;
      }

      .jump-text:hover span {
        animation: jump 0.4s ease;
      }

      .jump-text span:nth-child(1) { animation-delay: 0ms; }
      .jump-text span:nth-child(2) { animation-delay: 25ms; }
      .jump-text span:nth-child(3) { animation-delay: 50ms; }
      .jump-text span:nth-child(4) { animation-delay: 75ms; }
      .jump-text span:nth-child(5) { animation-delay: 100ms; }
      .jump-text span:nth-child(6) { animation-delay: 125ms; }
      .jump-text span:nth-child(7) { animation-delay: 150ms; }
      .jump-text span:nth-child(8) { animation-delay: 175ms; }
      .jump-text span:nth-child(9) { animation-delay: 200ms; }
      .jump-text span:nth-child(10) { animation-delay: 225ms; }
      .jump-text span:nth-child(11) { animation-delay: 250ms; }
      .jump-text span:nth-child(12) { animation-delay: 275ms; }
      .jump-text span:nth-child(13) { animation-delay: 300ms; }
      .jump-text span:nth-child(14) { animation-delay: 325ms; }
      .jump-text span:nth-child(15) { animation-delay: 350ms; }

      @keyframes jump {
        0%, 100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-4px);
        }
      }

      /* ===== Reduced Motion ===== */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          transition-duration: 0.01ms !important;
          animation-duration: 0.01ms !important;
        }
      }
    </style>
  </head>
  <body>
    <h1>OTLP Payload Validator</h1>
    <p class="subtitle">
      Validate OpenTelemetry Protocol (OTLP) payloads for traces, logs, and
      metrics
    </p>
    <div class="header-row">
      <a href="https://github.com/AbhiPrasad/otel-validator/" class="github-link" target="_blank" rel="noopener noreferrer">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
        View on GitHub
      </a>
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
        <svg class="sun-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
        </svg>
        <svg class="moon-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/>
        </svg>
      </button>
    </div>

    <div class="input-section">
      <h2>Input Payload</h2>
      <textarea
        id="payload-input"
        placeholder="Paste your OTLP JSON payload here..."
        spellcheck="false"></textarea>

      <div class="file-upload" id="file-drop">
        <p>Drop a file here or click to upload (.json or .pb files)</p>
        <input
          type="file"
          id="file-input"
          accept=".json,.pb,.bin"
          style="display: none"
        />
      </div>

      <div class="buttons">
        <button class="validate-btn" id="validate-btn">Validate</button>
        <button class="clear-btn" id="clear-btn">Clear</button>
        <button class="example-btn" id="example-traces">Example Traces</button>
        <button class="example-btn" id="example-logs">Example Logs</button>
        <button class="example-btn" id="example-metrics">Example Metrics</button
        >
      </div>
    </div>

    <div class="results-section">
      <h2>Validation Results</h2>
      <div id="results-container">
        <div class="result-status pending">
          Enter a payload and click Validate to see results
        </div>
      </div>
    </div>

    <footer class="footer">
      Built by <a href="https://abhiprasad.github.io/" target="_blank" rel="noopener noreferrer"><span class="jump-text"><span>A</span><span>b</span><span>h</span><span>i</span><span>j</span><span>e</span><span>e</span><span>t</span><span>&nbsp;</span><span>P</span><span>r</span><span>a</span><span>s</span><span>a</span><span>d</span></span></a>
    </footer>

    <script>
      // ===== Theme Management =====
      const getStoredTheme = (): string | null => localStorage.getItem('theme');
      const getSystemTheme = (): string =>
        window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';

      const setTheme = (theme: string): void => {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
      };

      // Initialize theme on page load
      const initTheme = (): void => {
        const stored = getStoredTheme();
        const theme = stored || getSystemTheme();
        setTheme(theme);
      };

      // Run immediately to avoid flash
      initTheme();

      // Listen for system preference changes (when no stored preference)
      window.matchMedia('(prefers-color-scheme: dark)')
        .addEventListener('change', (e: MediaQueryListEvent) => {
          if (!getStoredTheme()) {
            setTheme(e.matches ? 'dark' : 'light');
          }
        });

      // Theme toggle button handler
      const themeToggle = document.getElementById('theme-toggle');
      if (themeToggle) {
        themeToggle.onclick = (): void => {
          const current = document.documentElement.getAttribute('data-theme') || getSystemTheme();
          const next = current === 'dark' ? 'light' : 'dark';
          setTheme(next);
        };
      }

      // Example OTLP payloads
      const examples = {
        traces: {
          resourceSpans: [
            {
              resource: {
                attributes: [
                  { key: "service.name", value: { stringValue: "my-service" } },
                ],
              },
              scopeSpans: [
                {
                  scope: { name: "my-library", version: "1.0.0" },
                  spans: [
                    {
                      traceId: "0123456789abcdef0123456789abcdef",
                      spanId: "0123456789abcdef",
                      name: "GET /api/users",
                      kind: 2,
                      startTimeUnixNano: "1704067200000000000",
                      endTimeUnixNano: "1704067200100000000",
                      attributes: [
                        { key: "http.method", value: { stringValue: "GET" } },
                        { key: "http.status_code", value: { intValue: 200 } },
                      ],
                      status: { code: 1 },
                    },
                  ],
                },
              ],
            },
          ],
        },
        logs: {
          resourceLogs: [
            {
              resource: {
                attributes: [
                  { key: "service.name", value: { stringValue: "my-service" } },
                ],
              },
              scopeLogs: [
                {
                  scope: { name: "my-logger" },
                  logRecords: [
                    {
                      timeUnixNano: "1704067200000000000",
                      observedTimeUnixNano: "1704067200001000000",
                      severityNumber: 9,
                      severityText: "INFO",
                      body: { stringValue: "User logged in successfully" },
                      attributes: [
                        { key: "user.id", value: { stringValue: "12345" } },
                      ],
                    },
                  ],
                },
              ],
            },
          ],
        },
        metrics: {
          resourceMetrics: [
            {
              resource: {
                attributes: [
                  { key: "service.name", value: { stringValue: "my-service" } },
                ],
              },
              scopeMetrics: [
                {
                  scope: { name: "my-meter" },
                  metrics: [
                    {
                      name: "http.request.duration",
                      description: "Duration of HTTP requests",
                      unit: "ms",
                      histogram: {
                        aggregationTemporality: 2,
                        dataPoints: [
                          {
                            startTimeUnixNano: "1704067200000000000",
                            timeUnixNano: "1704067260000000000",
                            count: "100",
                            sum: 5432.1,
                            bucketCounts: ["10", "25", "40", "20", "5"],
                            explicitBounds: [10, 50, 100, 500],
                            min: 2.5,
                            max: 892.3,
                          },
                        ],
                      },
                    },
                  ],
                },
              ],
            },
          ],
        },
      };

      // Type definitions
      interface ValidationError {
        path: string;
        message: string;
        keyword: string;
        schemaPath: string;
      }

      interface ValidationWarning {
        path: string;
        message: string;
        suggestion?: string;
      }

      interface ValidationResult {
        success: boolean;
        payloadType: string | null;
        errors?: ValidationError[];
        warnings?: ValidationWarning[];
        message?: string;
      }

      const textarea = document.getElementById(
        "payload-input"
      ) as HTMLTextAreaElement;
      const validateBtn = document.getElementById(
        "validate-btn"
      ) as HTMLButtonElement;
      const clearBtn = document.getElementById(
        "clear-btn"
      ) as HTMLButtonElement;
      const resultsContainer = document.getElementById(
        "results-container"
      ) as HTMLDivElement;
      const fileDrop = document.getElementById("file-drop") as HTMLDivElement;
      const fileInput = document.getElementById(
        "file-input"
      ) as HTMLInputElement;

      // Store last validation result for copy functionality
      let lastValidationResult: ValidationResult | null = null;

      // Example buttons
      const exampleTracesBtn = document.getElementById("example-traces");
      const exampleLogsBtn = document.getElementById("example-logs");
      const exampleMetricsBtn = document.getElementById("example-metrics");

      if (exampleTracesBtn) {
        exampleTracesBtn.onclick = () => {
          textarea.value = JSON.stringify(examples.traces, null, 2);
        };
      }
      if (exampleLogsBtn) {
        exampleLogsBtn.onclick = () => {
          textarea.value = JSON.stringify(examples.logs, null, 2);
        };
      }
      if (exampleMetricsBtn) {
        exampleMetricsBtn.onclick = () => {
          textarea.value = JSON.stringify(examples.metrics, null, 2);
        };
      }

      // Clear button
      clearBtn.onclick = () => {
        textarea.value = "";
        resultsContainer.innerHTML = `
          <div class="result-status pending">
            Enter a payload and click Validate to see results
          </div>
        `;
      };

      // File upload handling
      fileDrop.onclick = () => fileInput.click();

      fileDrop.ondragover = (e: DragEvent) => {
        e.preventDefault();
        fileDrop.classList.add("dragover");
      };

      fileDrop.ondragleave = () => {
        fileDrop.classList.remove("dragover");
      };

      fileDrop.ondrop = async (e: DragEvent) => {
        e.preventDefault();
        fileDrop.classList.remove("dragover");
        const file = e.dataTransfer?.files[0];
        if (file) await handleFile(file);
      };

      fileInput.onchange = async (e: Event) => {
        const target = e.target as HTMLInputElement;
        const file = target.files?.[0];
        if (file) await handleFile(file);
      };

      async function handleFile(file: File): Promise<void> {
        if (file.name.endsWith(".json")) {
          const text = await file.text();
          textarea.value = text;
        } else if (file.name.endsWith(".pb") || file.name.endsWith(".bin")) {
          // Binary file - validate directly
          await validateProtobuf(file);
        } else {
          // Try to read as text
          const text = await file.text();
          textarea.value = text;
        }
      }

      async function validateProtobuf(file: File): Promise<void> {
        validateBtn.disabled = true;
        validateBtn.textContent = "Validating...";

        try {
          const buffer = await file.arrayBuffer();
          const response = await fetch("/api/validate", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-protobuf",
            },
            body: buffer,
          });

          const result: ValidationResult = await response.json();
          displayResults(result);
        } catch (e) {
          const error = e instanceof Error ? e.message : "Unknown error";
          displayResults({
            success: false,
            payloadType: null,
            errors: [
              {
                path: "",
                message: error,
                keyword: "network",
                schemaPath: "#",
              },
            ],
          });
        } finally {
          validateBtn.disabled = false;
          validateBtn.textContent = "Validate";
        }
      }

      // Validate button
      validateBtn.onclick = async () => {
        const payload = textarea.value.trim();

        if (!payload) {
          displayResults({
            success: false,
            payloadType: null,
            errors: [
              {
                path: "",
                message: "Please enter a payload",
                keyword: "required",
                schemaPath: "#",
              },
            ],
          });
          return;
        }

        validateBtn.disabled = true;
        validateBtn.textContent = "Validating...";

        try {
          const response = await fetch("/api/validate", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: payload,
          });

          const result: ValidationResult = await response.json();
          displayResults(result);
        } catch (e) {
          const error = e instanceof Error ? e.message : "Unknown error";
          displayResults({
            success: false,
            payloadType: null,
            errors: [
              {
                path: "",
                message: error,
                keyword: "network",
                schemaPath: "#",
              },
            ],
          });
        } finally {
          validateBtn.disabled = false;
          validateBtn.textContent = "Validate";
        }
      };

      // Keyboard shortcut: Ctrl/Cmd + Enter to validate
      textarea.onkeydown = (e: KeyboardEvent) => {
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
          e.preventDefault();
          validateBtn.click();
        }
      };

      function displayResults(result: ValidationResult): void {
        let html = "";

        if (result.success) {
          html = `
            <div class="result-status valid">
              <span>‚úì Valid payload</span>
              <span class="payload-type">${result.payloadType}</span>
            </div>
          `;
        } else {
          html = `
            <div class="result-status invalid">
              <span>‚úó Invalid payload</span>
              ${result.payloadType ? `<span class="payload-type">${result.payloadType}</span>` : ""}
            </div>
          `;

          const errorCount = result.errors ? result.errors.length : 0;
          const warningCount = result.warnings ? result.warnings.length : 0;

          // Store the result for copy functionality
          lastValidationResult = result;

          if (errorCount > 0 || warningCount > 0) {
            html += `<div class="summary-bar">`;
            if (errorCount > 0) {
              html += `<span class="summary-item errors">‚ö† ${errorCount} error${errorCount !== 1 ? "s" : ""}</span>`;
            }
            if (warningCount > 0) {
              html += `<span class="summary-item warnings">‚ö° ${warningCount} warning${warningCount !== 1 ? "s" : ""}</span>`;
            }
            html += `<button class="copy-llm-btn" id="copy-llm-btn" title="Copy errors formatted for AI assistants">üìã Copy for LLMs</button>`;
            html += `</div>`;
          }

          if (result.errors && result.errors.length > 0) {
            // Group errors by path
            const errorsByPath: Record<string, ValidationError[]> = {};
            for (const error of result.errors) {
              const path = error.path || "(root)";
              if (!errorsByPath[path]) {
                errorsByPath[path] = [];
              }
              errorsByPath[path].push(error);
            }

            html += '<h3>Errors</h3><div class="error-list">';

            for (const [path, errors] of Object.entries(errorsByPath)) {
              const displayPath = formatPath(path);

              html += `
                <div class="error-group">
                  <div class="error-group-header">
                    <span class="path-icon">üìç</span>
                    <span class="path-text">${escapeHtml(displayPath)}</span>
                    ${errors.length > 1 ? `<span class="error-count">${errors.length}</span>` : ""}
                  </div>
                  <div class="error-group-body">
              `;

              for (const error of errors) {
                const keywordClass = getKeywordClass(error.keyword);
                html += `
                  <div class="error-item">
                    <span class="error-icon">‚úï</span>
                    <div class="error-content">
                      <div class="error-message">${escapeHtml(error.message)}</div>
                      <div class="error-meta">
                        <span class="error-keyword ${keywordClass}">${escapeHtml(error.keyword)}</span>
                      </div>
                    </div>
                  </div>
                `;
              }

              html += `</div></div>`;
            }

            html += "</div>";
          }
        }

        // Warnings (show for both valid and invalid)
        if (result.warnings && result.warnings.length > 0) {
          // Group warnings by path
          const warningsByPath: Record<string, ValidationWarning[]> = {};
          for (const warning of result.warnings) {
            const path = warning.path || "(root)";
            if (!warningsByPath[path]) {
              warningsByPath[path] = [];
            }
            warningsByPath[path].push(warning);
          }

          html += '<h3>Warnings</h3><div class="warning-list">';

          for (const [path, warnings] of Object.entries(warningsByPath)) {
            const displayPath = formatPath(path);

            html += `
              <div class="warning-group">
                <div class="warning-group-header">
                  <span class="path-icon">üìç</span>
                  <span class="path-text">${escapeHtml(displayPath)}</span>
                </div>
                <div class="warning-group-body">
            `;

            for (const warning of warnings) {
              html += `
                <div class="warning-item">
                  <span class="warning-icon">‚ö†</span>
                  <div class="warning-content">
                    <div class="warning-message">${escapeHtml(warning.message)}</div>
                    ${warning.suggestion ? `<div class="warning-suggestion">üí° ${escapeHtml(warning.suggestion)}</div>` : ""}
                  </div>
                </div>
              `;
            }

            html += `</div></div>`;
          }

          html += "</div>";
        }

        resultsContainer.innerHTML = html;

        // Attach copy button event listener if present
        const copyBtn = document.getElementById("copy-llm-btn");
        if (copyBtn) {
          copyBtn.onclick = copyErrorsForLLM;
        }
      }

      function copyErrorsForLLM(): void {
        const result = lastValidationResult;
        if (!result) return;

        const markdown = formatResultAsMarkdown(result);

        navigator.clipboard
          .writeText(markdown)
          .then(() => {
            const btn = document.getElementById("copy-llm-btn");
            if (btn) {
              btn.classList.add("copied");
              btn.innerHTML = "‚úì Copied!";
              setTimeout(() => {
                btn.classList.remove("copied");
                btn.innerHTML = "üìã Copy for LLMs";
              }, 2000);
            }
          })
          .catch((err: unknown) => {
            console.error("Failed to copy:", err);
            alert("Failed to copy to clipboard");
          });
      }

      function formatResultAsMarkdown(result: ValidationResult): string {
        let md = "";

        // Header
        md += `## OTLP Validation Errors\n\n`;

        if (result.payloadType) {
          md += `**Payload Type:** ${result.payloadType}\n\n`;
        }

        const errorCount = result.errors ? result.errors.length : 0;
        const warningCount = result.warnings ? result.warnings.length : 0;

        md += `**Status:** ${errorCount} error${errorCount !== 1 ? "s" : ""}`;
        if (warningCount > 0) {
          md += `, ${warningCount} warning${warningCount !== 1 ? "s" : ""}`;
        }
        md += `\n\n`;

        // Errors grouped by path
        if (result.errors && result.errors.length > 0) {
          md += `### Errors\n\n`;

          // Group by path
          const errorsByPath: Record<string, ValidationError[]> = {};
          for (const error of result.errors) {
            const path = error.path || "(root)";
            if (!errorsByPath[path]) {
              errorsByPath[path] = [];
            }
            errorsByPath[path].push(error);
          }

          for (const [path, errors] of Object.entries(errorsByPath)) {
            md += `#### \`${path}\`\n\n`;
            for (const error of errors) {
              md += `- **${error.keyword}**: ${error.message}\n`;
            }
            md += `\n`;
          }
        }

        // Warnings grouped by path
        if (result.warnings && result.warnings.length > 0) {
          md += `### Warnings\n\n`;

          const warningsByPath: Record<string, ValidationWarning[]> = {};
          for (const warning of result.warnings) {
            const path = warning.path || "(root)";
            if (!warningsByPath[path]) {
              warningsByPath[path] = [];
            }
            warningsByPath[path].push(warning);
          }

          for (const [path, warnings] of Object.entries(warningsByPath)) {
            md += `#### \`${path}\`\n\n`;
            for (const warning of warnings) {
              md += `- ${warning.message}\n`;
              if (warning.suggestion) {
                md += `  - *Suggestion: ${warning.suggestion}*\n`;
              }
            }
            md += `\n`;
          }
        }

        // Add context for LLM
        md += `---\n\n`;
        md += `*These are validation errors from an OTLP (OpenTelemetry Protocol) payload. `;
        md += `Please help me understand and fix these issues.*\n`;

        return md;
      }

      function formatPath(path: string): string {
        if (!path || path === "/" || path === "(root)") {
          return "(root)";
        }
        // Make the path more readable by adding spaces around slashes for wrapping
        // and highlighting the key parts
        return path;
      }

      function getKeywordClass(keyword: string): string {
        const keywordMap: Record<string, string> = {
          type: "type",
          pattern: "pattern",
          enum: "enum",
          required: "required",
          semantic: "semantic",
        };
        return keywordMap[keyword] || "";
      }

      function escapeHtml(str: string): string {
        if (!str) return "";
        return str
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;");
      }
    </script>
  </body>
</html>
